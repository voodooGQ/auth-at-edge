Type: AWS::CloudFront::Distribution
Properties:
  DistributionConfig:
    Enabled: true
    Logging:
      Bucket: !GetAtt DistributionLogBucket.DomainName
      IncludeCookies: true
    CacheBehaviors:
      # References to the Parameters ends up failing with
      # an object being found instead of a string.
      # @TODO: Work on getting variables in
      - PathPattern: /parseauth
        Compress: true
        ForwardedValues:
          QueryString: true
        TargetOriginId: dummy-origin
        ViewerProtocolPolicy: redirect-to-https
      - PathPattern: /refreshauth
        Compress: true
        ForwardedValues:
          QueryString: true
        TargetOriginId: dummy-origin
        ViewerProtocolPolicy: redirect-to-https
      - PathPattern: /
        Compress: true
        ForwardedValues:
          QueryString: true
        TargetOriginId: dummy-origin
        ViewerProtocolPolicy: redirect-to-https
    DefaultCacheBehavior:
      Compress: true
      ForwardedValues:
        QueryString: true
      TargetOriginId: protected-bucket
      ViewerProtocolPolicy: redirect-to-https
    Origins:
    - DomainName: !Join
      - '.'
      - - !Ref S3Bucket
        - 's3.amazonaws.com'
      Id: protected-bucket
      OriginCustomHeaders: [
        {
          HeaderName: UserPoolId,
          HeaderValue: !Ref UserPool
        },
        {
          HeaderName: ClientId,
          HeaderValue: !Ref UserPoolClient
        },
        {
          HeaderName: CognitoAuthDomain,
          HeaderValue: !GetAtt UserPoolDomain.DomainName
        },
      ]
      S3OriginConfig:
        OriginAccessIdentity: !Join
          - '/'
          - - 'origin-access-identity'
            - 'cloudfront'
            - !Ref CloudFrontOriginAccessIdentity
    - DomainName: example.org
      Id: dummy-origin
      CustomOriginConfig:
        OriginProtocolPolicy: match-viewer
    CustomErrorResponses:
      - ErrorCode: 403
        ResponseCode: 200
        ResponsePagePath: /index.html
      - ErrorCode: 404
        ResponseCode: 200
        ResponsePagePath: /index.html
