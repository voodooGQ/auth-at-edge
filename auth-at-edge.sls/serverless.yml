service: private-spa

plugins:
- serverless-webpack

provider:
  name: aws
  runtime: nodejs10.x

# After adding a few functions and associated dependencies, individual function
# packages can be created to avoid a single massive zip file.
# This comes at the cost of potential memory issues at build time:
# https://github.com/serverless-heaven/serverless-webpack/issues/299
# package:
#   individually: true

custom:
  webpack:
    excludeFiles:
      - "src/**/*.test.ts"
      - "src/**/__mocks__/*.ts"
    # We could exclude aws-sdk here to trim down the deployment package via
    # webpack-node-externals (see webpack.config.js), but instead we'll
    # include it so the sdk version used is predictable.
    # includeModules:
    #   forceExclude:
    #     - aws-sdk

functions:
  check-auth:
    handler: src/check-auth/index.handler
    role: LambdaEdgeExecutionRole
    events:
      - http:
          path: check-auth
          method: post
          cors: true
  http-headers:
    handler: src/http-headers/index.handler
    role: LambdaEdgeExecutionRole
    events:
      - http:
          path: http-headers
          method: get
          cors: true

resources:
  Resources:
    S3Bucket: ${file(./src/resources/s3.bucket.yml)}
    LambdaEdgeExecutionRole: ${file(./src/resources/lambda_edge_execution.role.yml)}
